<!doctype html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>在 Linux 下创建、优化、删除 Swap 分区 | FASTCHEN</title>

  
<link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">

  
<link rel="stylesheet" href="/bootstrap/css/bootstrap-icons.min.css">

  
<link rel="stylesheet" href="/css/style.css">


  <link rel="shortcut icon" href="/favicon.ico">

  <meta name="description" content="一介凡人快辰的个人发牢骚之地。灵工艺的创始人。">
  <meta name="keywords" content="快辰,FastChen,灵工艺,NullCraft,创始人">

  <!-- Apple设备图标 -->
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_2022_256.png">
  <!-- Android设备图标 -->
  <link rel="icon" type="image/png" sizes="192x192" href="/images/logo_2022_256.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/images/logo_2022_256.png">

  <!-- Open Graph协议(社交媒体分享) -->
  <meta name="description" content="Linux 上的使用需求越来越高，这篇记录我在折腾 Linux 的 Swap 上的一些操作。">
<meta property="og:type" content="article">
<meta property="og:title" content="在 Linux 下创建、优化、删除 Swap 分区">
<meta property="og:url" content="https://fastchen.com/linux/linux-swap/index.html">
<meta property="og:site_name" content="FASTCHEN">
<meta property="og:description" content="Linux 上的使用需求越来越高，这篇记录我在折腾 Linux 的 Swap 上的一些操作。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-12-01T04:39:00.000Z">
<meta property="article:modified_time" content="2024-12-01T04:46:57.200Z">
<meta property="article:author" content="FastChen">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="运维">
<meta property="article:tag" content="Swap">
<meta name="twitter:card" content="summary">
<meta name="generator" content="Hexo 7.3.0"></head>

  <body class="bg-body-tertiary">
    <header class="bg-body p-3 mb-3 border-bottom">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
          <img width="32" height="32" src="/images/logo_2022_256.png" />
        </a>
        <ul class="nav nav-underline col-12 col-lg-auto me-lg-auto ms-3 mb-2 justify-content-center mb-md-0">
          
          <li><a href="/" class="nav-link px-2 link-body-emphasis">主页</a></li>
          
          <li><a href="/archives" class="nav-link px-2 link-body-emphasis">归档</a></li>
          
          <li><a href="/categories" class="nav-link px-2 link-body-emphasis">分类</a></li>
          
          <li><a href="/tags" class="nav-link px-2 link-body-emphasis">标签</a></li>
          
          <li><a href="/about" class="nav-link px-2 link-body-emphasis">关于我</a></li>
          
        </ul>
      </div>
    </div>
  </header>

    
    <div class="container my-5">
      <div class="post">
    <h1 class="post-title fw-semibold">
    
        <div class="text-center">
            在 Linux 下创建、优化、删除 Swap 分区
        </div>
    
</h1>

    
        <div class="text-center">
            
<div class="mb-4 text-muted author-info">
    
        <span title="2024-12-01T04:39:00.000Z"><i class="bi bi-calendar2 me-2" title="发布于 2024-12-01"></i>发布于 2024-12-01</span>
    
    
        <span class="ms-3" title="2024-12-01T04:46:57.200Z"><i class="bi bi-calendar2-plus me-2" title="更新于 2024-12-01"></i>更新于 2024-12-01</span>
    
    
    
        
            <span class="ms-3">
                <i class="bi bi-folder me-2"></i><a class="category-link" href="/categories/linux/">Linux</a>、<a class="category-link" href="/categories/write/">随便写写</a>
            </span>
        
    
</div>
        </div>
    

    
        <p>Linux 上的使用需求越来越高，这篇记录我在折腾 Linux 的 Swap 上的一些操作。</p>
<span id="more"></span>

<blockquote>
<p>以下操作需要在 root 账户下操作</p>
</blockquote>
<h2 id="新建-Swap-分区"><a href="#新建-Swap-分区" class="headerlink" title="新建 Swap 分区"></a>新建 Swap 分区</h2><p>查看内存占用情况</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回内容</span></span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           960Mi       368Mi       421Mi       2.0Mi       313Mi       592Mi</span><br><span class="line">Swap:             0B          0B          0B</span><br></pre></td></tr></table></figure>

<p>发现 Swap 分区并未分配交换分区</p>
<p>新增一个 Swap 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个 swapfile 到 / 目录，大小为 2G</span></span><br><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1M count=2048</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x2F;dev&#x2F;zero 无限填充 0 (0x00)</li>
<li>of 文件输出位置</li>
<li>bs 块大小 1K、1M、1G</li>
<li>count 块数量</li>
<li>文件的总大小 &#x3D; bs*count(块大小x块数量)</li>
</ol>
<p>Swap 文件创建成功返回结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@fastchen:~# <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swapfile bs=1M count=2048</span><br><span class="line">2048+0 records <span class="keyword">in</span></span><br><span class="line">2048+0 records out</span><br><span class="line">2147483648 bytes (2.1 GB, 2.0 GiB) copied, 4.50898 s, 476 MB/s</span><br></pre></td></tr></table></figure>

<p>修改文件权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> 0600 /swapfile</span><br></pre></td></tr></table></figure>

<p>将刚才创建的 <code>swapfile</code> 格式化为交换分区文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkswap /swapfile</span><br></pre></td></tr></table></figure>

<p>成功返回结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@fastchen:~# mkswap /swapfile</span><br><span class="line">Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)</span><br><span class="line">no label, UUID=4082e93d-9fc8-6985-ab32-080182ba7aba</span><br></pre></td></tr></table></figure>

<h2 id="启用-Swap-分区"><a href="#启用-Swap-分区" class="headerlink" title="启用 Swap 分区"></a>启用 Swap 分区</h2><p>创建完毕 Swap 后，需要启用和开启自动启用。</p>
<p>启用 Swap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapon /swapfile</span><br></pre></td></tr></table></figure>

<p>通过 free -h 查看是否成功启用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@fastchen:~# free -h</span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           960Mi       364Mi        66Mi       2.0Mi       678Mi       595Mi</span><br><span class="line">Swap:          2.0Gi          0B       2.0Gi</span><br></pre></td></tr></table></figure>

<p>设置开启自动启用 Swap</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fstab</span><br></pre></td></tr></table></figure>

<p>新增一行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/swapfile swap swap defaults 0 0</span><br></pre></td></tr></table></figure>

<ol>
<li>&#x2F;swapfile  swap 文件路径</li>
<li>swap 文件类型</li>
<li>swap 标签</li>
<li>defaults mkswap的默认参数</li>
<li>0 0 开始与结束位置</li>
</ol>
<h2 id="调整-Swap-使用优先级"><a href="#调整-Swap-使用优先级" class="headerlink" title="调整 Swap 使用优先级"></a>调整 Swap 使用优先级</h2><p>通过调整使用优先级可以控制物理内存与虚拟内存直接的平衡</p>
<p>一般情况没有特殊需求可以不用调整，而且会影响性能。</p>
<p>先查看当前优先级数值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /proc/sys/vm/swappiness</span><br></pre></td></tr></table></figure>

<p>根据使用情况可自行调整</p>
<p>数值范围：0 - 100 越大越积极使用 Swap</p>
<p>临时修改 (重启失效)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> sysctl vm.swappiness=80</span><br></pre></td></tr></table></figure>

<p>永久修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br></pre></td></tr></table></figure>

<p>找到 <code>vm.swappiness</code> 修改 &#x3D; 号后面的数值即可</p>
<p>如果没有可以手动增加</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.swappiness = 数值</span><br></pre></td></tr></table></figure>

<p>修改完毕后如果没有生效则需要重启系统</p>
<h2 id="删除-Swap-分区"><a href="#删除-Swap-分区" class="headerlink" title="删除 Swap 分区"></a>删除 Swap 分区</h2><p>停止当前 Swap 分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swapoff /swapfile</span><br></pre></td></tr></table></figure>

<p>删除 Swap 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> /swapfile</span><br></pre></td></tr></table></figure>

<p>删除开机启动</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑文件</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 swap 启动</span></span><br><span class="line">/swapfile swap swap defaults 0 0</span><br></pre></td></tr></table></figure>

<p>通过 <code>free -h</code> 检查结果</p>

      
    
    

    
        
            <a href="/tags/Linux/"><span class="tag-item" data-tag="Linux">#Linux</span></a>
        
            <a href="/tags/%E8%BF%90%E7%BB%B4/"><span class="tag-item" data-tag="运维">#运维</span></a>
        
            <a href="/tags/Swap/"><span class="tag-item" data-tag="Swap">#Swap</span></a>
        
    

</div>
    </div>

    
<!-- 返回顶部 -->
<a href="#" id="back-to-top" class="btn btn-secondary back-to-top" title="返回顶部"><i class="bi bi-arrow-up" style="width: auto;"></i></a>

<script src="/js/utils/back-to-top.js"></script>


    <footer class="border-top bg-body">
  <div class="container">
    
    <div class="d-flex flex-column flex-sm-row justify-content-between py-3 mt-3">
      <div>
        <a href="/" class="link-body-emphasis text-decoration-none">
          <img width="32" height="32" src="/images/logo_2022_256.png" />
        </a>
        <span class="ms-2">
          © 2025 <a href="https://fastchen.com">FASTCHEN</a> All Rights Reserved. 由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://github.com/FastChen/hexo-theme-sujian" rel="noopener" target="_blank">SuJian</a> 强力驱动
        </span>
      </div>

      <ul class="list-unstyled d-flex d-grid gap-3">
          
            
            
            
            <li>
                <a class="link-body-emphasis" target="_blank" rel="noopener" href="https://github.com/fastchen">
                <i class="bi bi-github" style="font-size: 24px;"></i>
              </a>
            </li>
          
      </ul>
    </div>
  </div>
</footer>




<script src="/bootstrap/js/bootstrap.min.js"></script>



<script src="/js/utils/tag-color.js"></script>

<script>
// 页面加载后设置标签颜色
document.addEventListener('DOMContentLoaded', function() {
    TagColor.applyRandomColorsToAll('.tag-item');
});
</script>
  </body>
  
</html>
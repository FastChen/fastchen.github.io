<!doctype html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>在 Linux 下管理磁盘分区 | FASTCHEN</title>

  
<link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">

  
<link rel="stylesheet" href="/bootstrap/css/bootstrap-icons.min.css">

  
<link rel="stylesheet" href="/css/style.css">


  <link rel="shortcut icon" href="/favicon.ico">

  <meta name="description" content="一介凡人快辰的个人发牢骚之地。灵工艺的创始人。">
  <meta name="keywords" content="快辰,FastChen,灵工艺,NullCraft,创始人">

  <!-- Apple设备图标 -->
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_2022_256.png">
  <!-- Android设备图标 -->
  <link rel="icon" type="image/png" sizes="192x192" href="/images/logo_2022_256.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/images/logo_2022_256.png">

  <!-- Open Graph协议(社交媒体分享) -->
  <meta name="description" content="新建了一台机器，发现它的 swap 是单独创建的一块物理磁盘分区，我使用 fdisk 删除 swap 的 vda2 分区然后将容量合并到主分区中，记录一下基本的使用过程。">
<meta property="og:type" content="article">
<meta property="og:title" content="在 Linux 下管理磁盘分区">
<meta property="og:url" content="https://fastchen.com/linux/linux-fdisk/index.html">
<meta property="og:site_name" content="FASTCHEN">
<meta property="og:description" content="新建了一台机器，发现它的 swap 是单独创建的一块物理磁盘分区，我使用 fdisk 删除 swap 的 vda2 分区然后将容量合并到主分区中，记录一下基本的使用过程。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-07-28T15:00:00.000Z">
<meta property="article:modified_time" content="2025-07-28T15:37:07.912Z">
<meta property="article:author" content="FastChen">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="运维">
<meta property="article:tag" content="fdisk">
<meta property="article:tag" content="swap">
<meta name="twitter:card" content="summary">
<meta name="generator" content="Hexo 7.3.0"></head>

  <body class="bg-body-tertiary">
    <header class="bg-body p-3 mb-3 border-bottom">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
          <img width="32" height="32" src="/images/logo_2022_256.png" />
        </a>
        <ul class="nav nav-underline col-12 col-lg-auto me-lg-auto ms-3 mb-2 justify-content-center mb-md-0">
          
          <li><a href="/" class="nav-link px-2 link-body-emphasis">主页</a></li>
          
          <li><a href="/archives" class="nav-link px-2 link-body-emphasis">归档</a></li>
          
          <li><a href="/categories" class="nav-link px-2 link-body-emphasis">分类</a></li>
          
          <li><a href="/tags" class="nav-link px-2 link-body-emphasis">标签</a></li>
          
          <li><a href="/about" class="nav-link px-2 link-body-emphasis">关于我</a></li>
          
        </ul>
      </div>
    </div>
  </header>

    
    <div class="container my-5">
      <div class="post">
    <h1 class="post-title fw-semibold">
    
        <div class="text-center">
            在 Linux 下管理磁盘分区
        </div>
    
</h1>

    
        <div class="text-center">
            
<div class="mb-4 text-muted author-info">
    
        <span title="2025-07-28T15:00:00.000Z"><i class="bi bi-calendar2 me-2" title="发布于 2025-07-28"></i>发布于 2025-07-28</span>
    
    
        <span class="ms-3" title="2025-07-28T15:37:07.912Z"><i class="bi bi-calendar2-plus me-2" title="更新于 2025-07-28"></i>更新于 2025-07-28</span>
    
    
    
        
            <span class="ms-3">
                <i class="bi bi-folder me-2"></i><a class="category-link" href="/categories/linux/">Linux</a>、<a class="category-link" href="/categories/write/">随便写写</a>
            </span>
        
    
</div>
        </div>
    

    
        <p>新建了一台机器，发现它的 swap 是单独创建的一块物理磁盘分区，我使用 fdisk 删除 swap 的 vda2 分区然后将容量合并到主分区中，记录一下基本的使用过程。</p>
<span id="more"></span>

<p>查看到的 swap 大致信息如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># free -h</span></span><br><span class="line">               total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           1.9Gi       226Mi       1.7Gi       2.0Mi       129Mi       1.7Gi</span><br><span class="line">Swap:          1.0Gi          0B       1.0Gi</span><br><span class="line"><span class="comment"># swapon</span></span><br><span class="line">NAME      TYPE       SIZE USED PRIO</span><br><span class="line">/dev/vda2 partition 1023M   0B   -2</span><br></pre></td></tr></table></figure>

<p>发现 swap 在 vda2 上，直接删，然后以 swap 文件形式创建更大的。</p>
<p>先禁用 swap 分区。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 禁用 /dev/vda2</span><br><span class="line">sudo swapoff /dev/vda2</span><br><span class="line"># 检查是否存在 fstab 条目，一般不存在。</span><br><span class="line">sudo vim /etc/fstab</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以下操作需要在 root 账户下操作，所有操作不可逆，操作分区表非常危险，务必备份重要文件后操作！！！</p>
</blockquote>
<h2 id="查看分区"><a href="#查看分区" class="headerlink" title="查看分区"></a>查看分区</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入 fdisk 操作。</span></span><br><span class="line"><span class="built_in">sudo</span> fdisk /dev/vda</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入 fdisk 交互。</span></span><br><span class="line">Welcome to fdisk (util-linux 2.38.1).</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, <span class="keyword">until</span> you decide to write them.</span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">This disk is currently <span class="keyword">in</span> use - repartitioning is probably a bad idea.</span><br><span class="line">It<span class="string">&#x27;s recommended to umount all file systems, and swapoff all swap</span></span><br><span class="line"><span class="string">partitions on this disk.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Command (m for help): </span></span><br></pre></td></tr></table></figure>

<p>输入 <code>p</code> 查看当前分区信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vda: 120 GiB, 128849018880 bytes, 251658240 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: A6zz1F2A-27A6-4zzF-Bzz9-77CFzzAzz80C</span><br><span class="line"></span><br><span class="line">Device         Start       End   Sectors  Size Type</span><br><span class="line">/dev/vda1       2048 249561088 249559041  119G Linux filesystem</span><br><span class="line">/dev/vda2  249563136 251658206   2095071 1023M Linux swap</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>/dev/vda2</code> 是 Linux swap 类型分区。</p>
<h2 id="删除分区"><a href="#删除分区" class="headerlink" title="删除分区"></a>删除分区</h2><p>通过上面的查询，找到了我们要删除的分区</p>
<p>交互界面输入 <code>d</code> 命令进行删除分区，其中 <code>/dev/vda2</code> 排列位为 <code>2</code> 号则输入 <code>2</code> 来删除它</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): d</span><br><span class="line">Partition number (1,2, default 2): 2</span><br><span class="line"></span><br><span class="line">Partition 2 has been deleted.</span><br></pre></td></tr></table></figure>

<h2 id="保存更改"><a href="#保存更改" class="headerlink" title="保存更改"></a>保存更改</h2><p>输入命令 <code>w</code> 保存更改并退出。</p>
<h2 id="拓展主分区"><a href="#拓展主分区" class="headerlink" title="拓展主分区"></a>拓展主分区</h2><p>我们删掉分区后还需要将被删掉的分区容量合并进入主分区内。</p>
<p>变动分区表保存后，先重启一下机器让内核重新识别分区表的变动。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> reboot</span><br></pre></td></tr></table></figure>

<p>再次进入 fdisk</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> fdisk /dev/vda</span><br><span class="line"></span><br><span class="line"><span class="comment"># sudo fdisk /dev/vda</span></span><br><span class="line"></span><br><span class="line">Welcome to fdisk (util-linux 2.38.1).</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, <span class="keyword">until</span> you decide to write them.</span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">This disk is currently <span class="keyword">in</span> use - repartitioning is probably a bad idea.</span><br><span class="line">It<span class="string">&#x27;s recommended to umount all file systems, and swapoff all swap</span></span><br><span class="line"><span class="string">partitions on this disk.</span></span><br></pre></td></tr></table></figure>

<p>再次查看分区表，确认只有一个主分区</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/vda: 120 GiB, 128849018880 bytes, 251658240 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: A6zz1F2A-27A6-4zzF-Bzz9-77CFzzAzz80C</span><br><span class="line"></span><br><span class="line">Device     Start       End   Sectors  Size Type</span><br><span class="line">/dev/vda1   2048 249561088 249559041  119G Linux filesystem</span><br></pre></td></tr></table></figure>

<p>然后我们将主分区表删除，稍后会重新建立主分区，这样可以完成拓展。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): d</span><br><span class="line">Selected partition 1</span><br><span class="line">Partition 1 has been deleted.</span><br></pre></td></tr></table></figure>

<p>输入 <code>n</code> 命令，创建新分区。</p>
<ol>
<li>Partition number(分区号)输入：1</li>
<li>First sector(起始扇区)输入：与之前的一致 我这里是 2048</li>
<li>Last sector(结束扇区)输入：如果使用最大值可以直接回车，或者自定义大小</li>
<li>Do you want to remove the signature? [Y]es&#x2F;[N]o(是否移除签名 [Y]&#x2F;[N]): 通常是选择 No</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Partition number (1-128, default 1): 1</span><br><span class="line">First sector (34-251658206, default 2048): 2048</span><br><span class="line">Last sector, +/-sectors or +/-size&#123;K,M,G,T,P&#125; (2048-251658206, default 251656191): </span><br><span class="line"></span><br><span class="line">Created a new partition 1 of <span class="built_in">type</span> <span class="string">&#x27;Linux filesystem&#x27;</span> and of size 120 GiB.</span><br><span class="line">Partition <span class="comment">#1 contains a ext4 signature.</span></span><br><span class="line"></span><br><span class="line">Do you want to remove the signature? [Y]es/[N]o: n</span><br></pre></td></tr></table></figure>

<p>然后直接输入 <code>w</code> 命令保存并退出 fdisk</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line"></span><br><span class="line">The partition table has been altered.</span><br><span class="line">Syncing disks.</span><br></pre></td></tr></table></figure>

<p>重启系统让系统重新读取分区表信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> reboot</span><br></pre></td></tr></table></figure>

<p>重启完毕后，拓展文件系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> resize2fs /dev/vda1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回</span></span><br><span class="line">resize2fs 1.47.0 (5-Feb-2023)</span><br><span class="line">Filesystem at /dev/vda1 is mounted on /; on-line resizing required</span><br><span class="line">old_desc_blocks = 15, new_desc_blocks = 15</span><br><span class="line">The filesystem on /dev/vda1 is now 31456768 (4k) blocks long.</span><br></pre></td></tr></table></figure>

<p>检查文件系统大小是否成功拓展</p>
<p>使用 fdisk -l 查看， End 接近 251658240 sectors 则代表成功。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> fdisk -l /dev/vda</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回</span></span><br><span class="line">Disk /dev/vda: 120 GiB, 128849018880 bytes, 251658240 sectors</span><br><span class="line">Units: sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disklabel <span class="built_in">type</span>: gpt</span><br><span class="line">Disk identifier: A6zz1F2A-27A6-4zzF-Bzz9-77CFzzAzz80C</span><br><span class="line"></span><br><span class="line">Device     Start       End   Sectors  Size Type</span><br><span class="line">/dev/vda1   2048 251656191 251654144  120G Linux filesystem</span><br></pre></td></tr></table></figure>

<p>使用 df -h 查看总容量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h /dev/vda1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回</span></span><br><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vda1       118G  1.3G  111G   2% /</span><br></pre></td></tr></table></figure>
      
    
    

    
        
            <a href="/tags/Linux/"><span class="tag-item" data-tag="Linux">#Linux</span></a>
        
            <a href="/tags/%E8%BF%90%E7%BB%B4/"><span class="tag-item" data-tag="运维">#运维</span></a>
        
            <a href="/tags/fdisk/"><span class="tag-item" data-tag="fdisk">#fdisk</span></a>
        
            <a href="/tags/swap/"><span class="tag-item" data-tag="swap">#swap</span></a>
        
    

</div>
    </div>

    
<!-- 返回顶部 -->
<a href="#" id="back-to-top" class="btn btn-secondary back-to-top" title="返回顶部"><i class="bi bi-arrow-up" style="width: auto;"></i></a>

<script src="/js/utils/back-to-top.js"></script>


    <footer class="border-top bg-body">
  <div class="container">
    
    <div class="d-flex flex-column flex-sm-row justify-content-between py-3 mt-3">
      <div>
        <a href="/" class="link-body-emphasis text-decoration-none">
          <img width="32" height="32" src="/images/logo_2022_256.png" />
        </a>
        <span class="ms-2">
          © 2025 <a href="https://fastchen.com">FASTCHEN</a> All Rights Reserved. 由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://github.com/FastChen/hexo-theme-sujian" rel="noopener" target="_blank">SuJian</a> 强力驱动
        </span>
      </div>

      <ul class="list-unstyled d-flex d-grid gap-3">
          
            
            
            
            <li>
                <a class="link-body-emphasis" target="_blank" rel="noopener" href="https://github.com/fastchen">
                <i class="bi bi-github" style="font-size: 24px;"></i>
              </a>
            </li>
          
      </ul>
    </div>
  </div>
</footer>




<script src="/bootstrap/js/bootstrap.min.js"></script>



<script src="/js/utils/tag-color.js"></script>

<script>
// 页面加载后设置标签颜色
document.addEventListener('DOMContentLoaded', function() {
    TagColor.applyRandomColorsToAll('.tag-item');
});
</script>
  </body>
  
</html>
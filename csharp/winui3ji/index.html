<!doctype html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>WinUI3 踩坑记(寄) | FASTCHEN</title>

  
<link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">

  
<link rel="stylesheet" href="/bootstrap/css/bootstrap-icons.min.css">

  
<link rel="stylesheet" href="/css/style.css">


  <link rel="shortcut icon" href="/favicon.ico">

  <meta name="description" content="一介凡人快辰的个人发牢骚之地。灵工艺的创始人。">
  <meta name="keywords" content="快辰,FastChen,灵工艺,NullCraft,创始人">

  <!-- Apple设备图标 -->
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_2022_256.png">
  <!-- Android设备图标 -->
  <link rel="icon" type="image/png" sizes="192x192" href="/images/logo_2022_256.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/images/logo_2022_256.png">

  <!-- Open Graph协议(社交媒体分享) -->
  <meta name="description" content="前言 心血来潮想体验体验 Windows11 的新 UI，也就是 WinUI3 结果踩了不少坑，所有这就是我的 WinUI3踩坑记(寄)了。">
<meta property="og:type" content="article">
<meta property="og:title" content="WinUI3 踩坑记(寄)">
<meta property="og:url" content="https://fastchen.com/csharp/winui3ji/index.html">
<meta property="og:site_name" content="FASTCHEN">
<meta property="og:description" content="前言 心血来潮想体验体验 Windows11 的新 UI，也就是 WinUI3 结果踩了不少坑，所有这就是我的 WinUI3踩坑记(寄)了。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fastchen.com/images/blog/20230506/vs_4.png">
<meta property="og:image" content="https://fastchen.com/images/blog/20230506/vs_5.png">
<meta property="og:image" content="https://fastchen.com/images/blog/20230506/vs_1.png">
<meta property="og:image" content="https://fastchen.com/images/blog/20230506/vs_2.png">
<meta property="og:image" content="https://fastchen.com/images/blog/20230506/vs_3.png">
<meta property="article:published_time" content="2023-05-06T15:42:00.000Z">
<meta property="article:modified_time" content="2024-01-11T15:59:26.129Z">
<meta property="article:author" content="FastChen">
<meta property="article:tag" content="Windows">
<meta property="article:tag" content="WinUI3">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fastchen.com/images/blog/20230506/vs_4.png">
<meta name="generator" content="Hexo 7.3.0"></head>

  <body class="bg-body-tertiary">
    <header class="bg-body p-3 mb-3 border-bottom">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
        <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 link-body-emphasis text-decoration-none">
          <img width="32" height="32" src="/images/logo_2022_256.png" />
        </a>
        <ul class="nav nav-underline col-12 col-lg-auto me-lg-auto ms-3 mb-2 justify-content-center mb-md-0">
          
          <li><a href="/" class="nav-link px-2 link-body-emphasis">主页</a></li>
          
          <li><a href="/archives" class="nav-link px-2 link-body-emphasis">归档</a></li>
          
          <li><a href="/categories" class="nav-link px-2 link-body-emphasis">分类</a></li>
          
          <li><a href="/tags" class="nav-link px-2 link-body-emphasis">标签</a></li>
          
          <li><a href="/about" class="nav-link px-2 link-body-emphasis">关于我</a></li>
          
        </ul>
      </div>
    </div>
  </header>

    
    <div class="container my-5">
      <div class="post">
    <h1 class="post-title fw-semibold">
    
        <div class="text-center">
            WinUI3 踩坑记(寄)
        </div>
    
</h1>

    
        <div class="text-center">
            
<div class="mb-4 text-muted author-info">
    
        <span title="2023-05-06T15:42:00.000Z"><i class="bi bi-calendar2 me-2" title="发布于 2023-05-06"></i>发布于 2023-05-06</span>
    
    
        <span class="ms-3" title="2024-01-11T15:59:26.129Z"><i class="bi bi-calendar2-plus me-2" title="更新于 2024-01-11"></i>更新于 2024-01-11</span>
    
    
    
        
            <span class="ms-3">
                <i class="bi bi-folder me-2"></i><a class="category-link" href="/categories/csharp/">C#</a>
            </span>
        
    
</div>
        </div>
    

    
        <p><strong>前言</strong></p>
<p>心血来潮想体验体验 Windows11 的新 UI，也就是 WinUI3 结果踩了不少坑，所有这就是我的 WinUI3踩坑记(寄)了。</p>
<span id="more"></span>

<h1 id="踩到了，但是我已经解决了的坑"><a href="#踩到了，但是我已经解决了的坑" class="headerlink" title="踩到了，但是我已经解决了的坑"></a>踩到了，但是我已经解决了的坑</h1><h2 id="第一坑-编码问题"><a href="#第一坑-编码问题" class="headerlink" title="第一坑 - 编码问题"></a>第一坑 - 编码问题</h2><p>通过官方给的插件生成的空白项目，输入中文会导致编译出来的程序有编码问题，经过检查发现是文件编码保存的问题。</p>
<h3 id="第一坑解决方案"><a href="#第一坑解决方案" class="headerlink" title="第一坑解决方案"></a>第一坑解决方案</h3><p><strong>使用高级保存选项 保存编码方式为 UTF-8</strong></p>
<p><img src="/images/blog/20230506/vs_4.png" alt="vs_4"><br><img src="/images/blog/20230506/vs_5.png" alt="vs_5"></p>
<blockquote>
<p>如果没有这个选项，按照下面的图片进行添加。</p>
</blockquote>
<p><img src="/images/blog/20230506/vs_1.png" alt="vs_1"><br><img src="/images/blog/20230506/vs_2.png" alt="vs_2"><br><img src="/images/blog/20230506/vs_3.png" alt="vs_3"></p>
<h2 id="第二坑-自定义-TitleBar-和-NavigationView-的配合"><a href="#第二坑-自定义-TitleBar-和-NavigationView-的配合" class="headerlink" title="第二坑 - 自定义 TitleBar 和 NavigationView 的配合"></a>第二坑 - 自定义 TitleBar 和 NavigationView 的配合</h2><p>微软官方给了完整代码，但是是错误的，因为 <code>TitleBar</code> 和容器在一起后会导致整体全部不可点击，如果配合 <code>NavigationView</code> 会导致 <code>BackButton</code> 不在同一行，还有颜色错误问题。</p>
<h3 id="第二坑相关引用"><a href="#第二坑相关引用" class="headerlink" title="第二坑相关引用"></a>第二坑相关引用</h3><ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/apps/develop/title-bar?tabs=wasdk">自定义标题栏</a> ——微软官方文档</li>
<li><a target="_blank" rel="noopener" href="https://github.com/microsoft/microsoft-ui-xaml/issues/7259">脱离标题栏仍然可点击 &#x2F; microsoft-ui-xaml issues #7259</a> ——Github</li>
<li><a target="_blank" rel="noopener" href="https://github.com/microsoft/WindowsAppSDK/issues/2574">自定义标题栏后导致不可点击 &#x2F; WindowsAppSDK issues #2574</a> ——Github<ul>
<li>据报告于 WindowsAppSDK 1.2 Preview 1 版中解决，但没有完全解决，使用未打包模式仍然错误。后续 Issues <a target="_blank" rel="noopener" href="https://github.com/microsoft/WindowsAppSDK/issues/2976">#2976</a></li>
</ul>
</li>
</ul>
<h3 id="第二坑解决方案"><a href="#第二坑解决方案" class="headerlink" title="第二坑解决方案"></a>第二坑解决方案</h3><p>本人最后修改得到完整代码如下：</p>
<figure class="highlight c#"><figcaption><span>MainWindow.xaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;Grid&gt;</span><br><span class="line">  &lt;Border</span><br><span class="line">      Canvas.ZIndex=<span class="string">&quot;0&quot;</span></span><br><span class="line">      IsHitTestVisible=<span class="string">&quot;False&quot;</span>&gt;</span><br><span class="line">      &lt;Grid</span><br><span class="line">          x:Name=<span class="string">&quot;AppTitleBar&quot;</span></span><br><span class="line">          Height=<span class="string">&quot;48&quot;</span></span><br><span class="line">          Margin=<span class="string">&quot;48,0,0,0&quot;</span></span><br><span class="line">          VerticalAlignment=<span class="string">&quot;Top&quot;</span></span><br><span class="line">          Padding=<span class="string">&quot;0&quot;</span>&gt;</span><br><span class="line">          &lt;Grid.ColumnDefinitions&gt;</span><br><span class="line">              &lt;ColumnDefinition Width=<span class="string">&quot;Auto&quot;</span> /&gt;</span><br><span class="line">              &lt;ColumnDefinition Width=<span class="string">&quot;Auto&quot;</span> /&gt;</span><br><span class="line">          &lt;/Grid.ColumnDefinitions&gt;</span><br><span class="line">          &lt;Image</span><br><span class="line">              x:Name=<span class="string">&quot;AppFontIcon&quot;</span></span><br><span class="line">              Width=<span class="string">&quot;16&quot;</span></span><br><span class="line">              Height=<span class="string">&quot;16&quot;</span></span><br><span class="line">              HorizontalAlignment=<span class="string">&quot;Left&quot;</span></span><br><span class="line">              VerticalAlignment=<span class="string">&quot;Center&quot;</span></span><br><span class="line">              Source=<span class="string">&quot;/Assets/Square44x44Logo.scale-200.png&quot;</span> /&gt;</span><br><span class="line">          &lt;TextBlock</span><br><span class="line">              Margin=<span class="string">&quot;12,0,0,0&quot;</span></span><br><span class="line">              Grid.Column=<span class="string">&quot;1&quot;</span></span><br><span class="line">              VerticalAlignment=<span class="string">&quot;Center&quot;</span></span><br><span class="line">              Style=<span class="string">&quot;&#123;StaticResource CaptionTextBlockStyle&#125;&quot;</span></span><br><span class="line">              Text=<span class="string">&quot;&#123;x:Bind AppTitleName&#125;&quot;</span>/&gt;</span><br><span class="line">      &lt;/Grid&gt;</span><br><span class="line">  &lt;/Border&gt;</span><br><span class="line"></span><br><span class="line">  &lt;NavigationView&gt;</span><br><span class="line">    &lt;NavigationView.MenuItems&gt;</span><br><span class="line">        &lt;NavigationViewItem Content=<span class="string">&quot;主页&quot;</span> Icon=<span class="string">&quot;Home&quot;</span> ToolTipService.ToolTip=<span class="string">&quot;Home&quot;</span> Tag=<span class="string">&quot;SettingsPage&quot;</span>/&gt;</span><br><span class="line">    &lt;/NavigationView.MenuItems&gt;</span><br><span class="line">    &lt;Frame x:Name=<span class="string">&quot;RootFrame&quot;</span> Navigated=<span class="string">&quot;RootFrame_Navigated&quot;</span>/&gt;</span><br><span class="line">  &lt;/NavigationView&gt;</span><br><span class="line">&lt;/Grid&gt;</span><br></pre></td></tr></table></figure>

<p>代码应用自定义 <code>TitleBar</code> 到窗体。</p>
<figure class="highlight c#"><figcaption><span>MainWindow.xaml.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MainWindow</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.InitializeComponent();</span><br><span class="line"></span><br><span class="line">    ExtendsContentIntoTitleBar = <span class="literal">true</span>;</span><br><span class="line">    SetTitleBar(AppTitleBar);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决 <code>TitleBar</code> 背景色和 <code>NavigationView</code> 位置的问题</p>
<figure class="highlight c#"><figcaption><span>App.xaml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Other app resources here --&gt;</span><br><span class="line">&lt;SolidColorBrush x:Key=<span class="string">&quot;WindowCaptionBackground&quot;</span>&gt;Transparent&lt;/SolidColorBrush&gt;</span><br><span class="line">&lt;SolidColorBrush x:Key=<span class="string">&quot;WindowCaptionBackgroundDisabled&quot;</span>&gt;Transparent&lt;/SolidColorBrush&gt;</span><br><span class="line">&lt;Thickness x:Key=<span class="string">&quot;NavigationViewContentMargin&quot;</span>&gt;<span class="number">0</span>,<span class="number">48</span>,<span class="number">0</span>,<span class="number">0</span>&lt;/Thickness&gt;</span><br></pre></td></tr></table></figure>

<h1 id="踩到了，但是我还没解决的坑"><a href="#踩到了，但是我还没解决的坑" class="headerlink" title="踩到了，但是我还没解决的坑"></a>踩到了，但是我还没解决的坑</h1><ul>
<li>Windows11 应用 Mica 效果失败 (Acrylic 效果可用)<br>相关链接：<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/windows/apps/windows-app-sdk/system-backdrop-controller">在桌面应用中为 Windows 11 应用 Mica 或 Acrylic 材料</a> ——微软官方文档</li>
<li><a target="_blank" rel="noopener" href="https://github.com/microsoft/WinUI-Gallery/blob/main/WinUIGallery/ControlPages/SystemBackdropsPage.xaml.cs">WinUI 3 Gallery SystemBackdropsPage.xaml.cs 源代码</a> ——官方示例</li>
</ul>
</li>
<li>NavigationView <code>PaneDisplayMode=&quot;Left&quot;</code> 的自适应问题<br>相关链接：<ul>
<li><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/uwp/api/windows.ui.xaml.controls.navigationview.expandedmodethresholdwidth?view=winrt-22621">NavigationView.ExpandedModeThresholdWidth 属性</a> ——微软官方文档</li>
</ul>
</li>
</ul>
<p>如果遇到其它问题将持续更新。。。</p>

      
    
    

    
        
            <a href="/tags/Windows/"><span class="tag-item" data-tag="Windows">#Windows</span></a>
        
            <a href="/tags/WinUI3/"><span class="tag-item" data-tag="WinUI3">#WinUI3</span></a>
        
    

</div>
    </div>

    
<!-- 返回顶部 -->
<a href="#" id="back-to-top" class="btn btn-secondary back-to-top" title="返回顶部"><i class="bi bi-arrow-up" style="width: auto;"></i></a>

<script src="/js/utils/back-to-top.js"></script>


    <footer class="border-top bg-body">
  <div class="container">
    
    <div class="d-flex flex-column flex-sm-row justify-content-between py-3 mt-3">
      <div>
        <a href="/" class="link-body-emphasis text-decoration-none">
          <img width="32" height="32" src="/images/logo_2022_256.png" />
        </a>
        <span class="ms-2">
          © 2025 <a href="https://fastchen.com">FASTCHEN</a> All Rights Reserved. 由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://github.com/FastChen/hexo-theme-sujian" rel="noopener" target="_blank">SuJian</a> 强力驱动
        </span>
      </div>

      <ul class="list-unstyled d-flex d-grid gap-3">
          
            
            
            
            <li>
                <a class="link-body-emphasis" target="_blank" rel="noopener" href="https://github.com/fastchen">
                <i class="bi bi-github" style="font-size: 24px;"></i>
              </a>
            </li>
          
      </ul>
    </div>
  </div>
</footer>




<script src="/bootstrap/js/bootstrap.min.js"></script>



<script src="/js/utils/tag-color.js"></script>

<script>
// 页面加载后设置标签颜色
document.addEventListener('DOMContentLoaded', function() {
    TagColor.applyRandomColorsToAll('.tag-item');
});
</script>
  </body>
  
</html>